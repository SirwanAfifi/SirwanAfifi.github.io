<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.0d3f539e93ffb77c2a2c.css">#disqus_thread{width:95%;margin:auto}@keyframes typing{0%{width:0}to{width:100%}}@keyframes blinking-cursor{0%,to{border-color:transparent}50%{border-color:rgba(48,91,170,.5)}}@keyframes moveInLeft{0%{opacity:0;transform:translateX(-10rem)}to{opacity:1;transform:translate(0)}}@keyframes moveInBottom{0%{opacity:0;transform:translateY(10rem)}to{opacity:1;transform:translate(0)}}*,:after,:before{margin:0;padding:0;box-sizing:inherit}html{font-size:62.5%}body{font-family:Cairo,sans-serif;font-weight:400;line-height:1.7rem;color:#777;-webkit-clip-path:polygon(0 0,100% 0,100% 75vh,0 100);clip-path:polygon(0 0,100% 0,100% 75vh,0 100);box-sizing:border-box}.images{width:100%;height:100%}.img-res{max-width:100%;height:auto;margin:0 auto}.row{max-width:114rem;background-color:#eee;margin:0 auto}.row:not(:last-child){margin-bottom:8rem}.row:after{content:"";display:table;clear:both}.row [class^=col-]{background-color:#ff4500;float:left}.row [class^=col-]:not(:last-child){margin-right:8rem}.row .col-1-of-2{width:calc((100% - 8rem)/2)}.row .col-1-of-3{width:calc((100% - 16rem)/3)}.row .col-2-of-3{width:calc(2*(100% - 16rem)/3 + 8rem)}.row .col-1-of-4{width:calc((100% - 24rem)/4)}.row .col-2-of-4{width:calc(2*(100% - 24rem)/4 + 8rem)}.row .col-3-of-4{width:calc(3*(100% - 24rem)/4 + 16rem)}.header{position:relative;height:100vh;background-image:linear-gradient(to right top,rgba(0,123,223,.8) 0,rgba(0,236,189,.8)),url(/img/bg.jpg);background-size:cover;background-position:top}.text-box{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center}.logo{animation-name:moveInBottom;animation-duration:3.5s}.heading-primary{color:#fff;text-transform:uppercase}.heading-primary-main{display:block;overflow:hidden;border-right:.1em solid rgba(48,91,171,.1);white-space:nowrap;font-size:6rem;font-weight:400;letter-spacing:3.5rem;animation:typing 3.5s steps(40),blinking-cursor .5s step-end infinite}.heading-primary-sub{display:block;font-size:2rem;font-weight:400;letter-spacing:1.74rem;animation-name:moveInLeft;animation-duration:3.5s}.socials,.socials a{color:#e6e6e6;margin:1rem}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}*{box-sizing:border-box}body,html{margin:0;padding:0}body{font-family:Open Sans,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;color:#454441;background-color:#fff}@media (min-width:990px){body{font-size:18px}}h1,h2,h3,h4,h5,h6{margin:0 0 10px;font-weight:600;line-height:1.25;text-rendering:optimizeLegibility}h1{font-size:40px}h2{margin-top:20px;font-size:32px}h3{margin-top:24px;font-size:24px}h4,h5,h6{margin-top:16px;font-size:16px}p{margin:0 0 15px}ol,ul{margin-bottom:15px}hr{position:relative;margin:40px 0;border:0;border-top:1px solid #eee;border-bottom:1px solid #fff}strong{color:#222}abbr{background-color:#eee;display:inline-block;padding:3px;font-size:13px;font-weight:700;color:#555;text-shadow:0 1px 1px hsla(0,0%,100%,.5);text-transform:uppercase;border-radius:3px}code,pre{font-family:Menlo,Monaco,Courier New,monospace}code{padding:.25em .5em;font-size:85%;color:#bf616a;border-radius:3px}pre{display:block;margin:0 0 14px;padding:15px 20px;font-size:16px;line-height:1.4;white-space:pre;white-space:pre-wrap;word-break:break-all;word-wrap:break-word}pre code{padding:0;font-size:100%;color:inherit;background-color:transparent}.highlight{margin-bottom:15px;border-radius:4px;margin-left:0;margin-right:0}.highlight pre{margin-bottom:0}blockquote{padding:5px 30px 5px 25px;margin:15px 0;border-left:5px solid #eee}blockquote p{margin-bottom:0;color:#7a7a7a;text-indent:-.4em}blockquote p:before{content:"\201C"}blockquote p:after{content:"\201D"}img{display:block;margin:0 0 15px;border-radius:5px}.lead{font-size:20px;font-weight:300}@media (min-width:990px){.lead{font-size:24px}}a{font-weight:600;color:#222;text-decoration:none}a:focus,a:hover{text-decoration:underline}.masthead{color:#fff;background-color:#2a2a2a}.masthead-inner{padding:20px}.masthead h1{margin-top:0;font-family:Abril Fatface}.masthead .lead{margin-bottom:0}.masthead a{color:#fff}.colophon{margin-top:20px;color:hsla(0,0%,100%,.5)}.colophon-links{padding-left:0;list-style:none}.colophon-links li{color:inherit}@media (min-width:768px){.masthead-inner{padding:40px}}@media (min-width:990px){.masthead{position:fixed;top:0;left:0;bottom:0;width:25%;margin-bottom:0}.masthead-inner{position:absolute;right:0;left:0}.masthead h1{font-size:64px}.colophon{margin-top:40px}}.content{padding:40px 20px}@media (min-width:990px){.content{padding:60px 0}.container{margin-left:30%;margin-right:10%}}.post{margin-bottom:40px}@media (min-width:990px){.post{margin-bottom:60px}}.post-date{display:block;margin:-10px 0 10px;color:#9a9a9a}.related{padding-top:20px;padding-bottom:40px;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#000;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-top:40px;font-weight:700;color:#ccc;text-align:center;border-top:1px solid #eee}@media (min-width:990px){.pagination{margin-bottom:60px;border:1px solid #eee}}.pagination a,.pagination span{float:left;width:50%;padding:20px}.pagination a:first-child,.pagination span:first-child{border-right:1px solid #eee}.pagination a:hover{text-decoration:none;background-color:#f5f5f5}@media (min-width:990px){.layout-reverse .masthead{left:auto;right:0}.layout-reverse .container{margin-left:10%;margin-right:35%}}.theme-base-08 .masthead{background-color:#ac4142}.theme-base-08 .container a,.theme-base-08 .related-posts li a:hover{color:#ac4142}.theme-base-09 .masthead{background-color:#d28445}.theme-base-09 .container a,.theme-base-09 .related-posts li a:hover{color:#d28445}.theme-base-0a .masthead{background-color:#f4bf75}.theme-base-0a .container a,.theme-base-0a .related-posts li a:hover{color:#f4bf75}.theme-base-0b .masthead{background-color:#90a959}.theme-base-0b .container a,.theme-base-0b .related-posts li a:hover{color:#90a959}.theme-base-0c .masthead{background-color:#75b5aa}.theme-base-0c .container a,.theme-base-0c .related-posts li a:hover{color:#75b5aa}.theme-base-0d .masthead{background-image:linear-gradient(0deg,#03a9f4,rgba(18,78,212,.75))}.theme-base-0d .container a,.theme-base-0d .related-posts li a:hover{color:#6a9fb5}.theme-base-0d .container a:hover{background:linear-gradient(0deg,#03a9f4,rgba(18,78,212,.75));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.theme-base-0e .masthead{background-color:#aa759f}.theme-base-0e .container a,.theme-base-0e .related-posts li a:hover{color:#aa759f}.theme-base-0f .masthead{background-color:#8f5536}.theme-base-0f .container a,.theme-base-0f .related-posts li a:hover{color:#8f5536}.profilepic img{border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;margin:0 auto;border:3px solid #fff}.home h1 a:hover{text-decoration:none}.home .title{font-family:Open Sans;font-weight:800;padding-bottom:15px}.home article .post-meta{margin-bottom:15px}.center-image{margin:0 auto}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.highlight .hll{background-color:#49483e}.highlight{background:#272822;color:#f8f8f2}.highlight .c{color:#75715e}.highlight .err{color:#960050;background-color:#1e0010}.highlight .k{color:#66d9ef}.highlight .l{color:#ae81ff}.highlight .n{color:#f8f8f2}.highlight .o{color:#f92672}.highlight .p{color:#f8f8f2}.highlight .c1,.highlight .ch,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .cs{color:#75715e}.highlight .gd{color:#f92672}.highlight .ge{font-style:italic}.highlight .gi{color:#a6e22e}.highlight .gs{font-weight:700}.highlight .gu{color:#75715e}.highlight .kc,.highlight .kd{color:#66d9ef}.highlight .kn{color:#f92672}.highlight .kp,.highlight .kr,.highlight .kt{color:#66d9ef}.highlight .ld{color:#e6db74}.highlight .m{color:#ae81ff}.highlight .s{color:#e6db74}.highlight .na{color:#a6e22e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#a6e22e}.highlight .no{color:#66d9ef}.highlight .nd{color:#a6e22e}.highlight .ni{color:#f8f8f2}.highlight .ne,.highlight .nf{color:#a6e22e}.highlight .nl,.highlight .nn{color:#f8f8f2}.highlight .nx{color:#a6e22e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f92672}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f92672}.highlight .w{color:#f8f8f2}.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo{color:#ae81ff}.highlight .dl,.highlight .s2,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .sd{color:#e6db74}.highlight .se{color:#ae81ff}.highlight .s1,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#e6db74}.highlight .bp{color:#f8f8f2}.highlight .fm{color:#a6e22e}.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#f8f8f2}.highlight .il{color:#ae81ff}.widget-container{display:flex;margin-bottom:20px}.bmc-button img{width:35px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{line-height:35px!important;height:51px!important;min-width:217px!important;display:inline-flex!important;background-color:#5f7fff!important;border-radius:5px!important;border:1px solid transparent!important;padding:7px 10px!important;font-size:28px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px hsla(0,0%,74.5%,.5)!important;margin:0 auto!important;font-family:Cookie,cursive!important;box-sizing:border-box!important;transition:all .3s linear!important}.bmc-button,.bmc-button:active,.bmc-button:focus,.bmc-button:hover{text-decoration:none!important;color:#fff!important;-webkit-box-shadow:0 1px 2px 2px hsla(0,0%,74.5%,.5)!important}.bmc-button:active,.bmc-button:focus,.bmc-button:hover{box-shadow:0 1px 2px 2px hsla(0,0%,74.5%,.5)!important;opacity:.85!important}</style><meta name="generator" content="Gatsby 2.13.18"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-15d8dc7caf8d5b05a8bb.js"/><link as="script" rel="preload" href="/app-319ed9ee6b302328ad48.js"/><link as="script" rel="preload" href="/styles-4a421e9d993baa00708b.js"/><link as="script" rel="preload" href="/1-3383a112591cc5742233.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-0914d98d5e3a1ad21021.js"/><link as="fetch" rel="preload" href="/page-data/archive/2020/03/08/WebSocket-and-React/page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div><header class="masthead"><div class="masthead-inner"><div class="profilepic"><a href="/blog"><img src="/avatar.png" alt="Profile Picture"/></a></div><h2>Sirwan Afifi</h2><p class="lead">Stories from a web developer.</p><div class="colophon"><ul class="colophon-links"><li><a href="/about">about</a></li><li><a href="/archive">archives</a></li><li><a href="/#">contact</a></li></ul><p>© <!-- -->2020<!-- -->. <!-- -->Sirwan Afifi<!-- --> All rights reserved.</p></div></div></header><div class="content container"><div class="post"><h1>WebSocket and React</h1><span class="post-date">March 8th, 2020<!-- --> |<!-- --> <span class="disqus-comment-count" data-disqus-identifier="WebSocket-and-React/" data-disqus-url="https://sirwan.info/archive/2020/03/08/WebSocket-and-React/">...</span></span><div><p>WebSocket is a communication protocol. It's bidirectional in nature which means that either client or server can send data at any time. With WebSocket, we can build applications such as multiplayer games, chat apps, collaboration software that work on the open web. In this blog, I going to show you how to create a WebSocket server both in .NET Core and Node.js. I'll start with the Node.js version as it's a bit easier (boilerplate code for it is just 13 lines of code).</p>
<h2>WebSocket Server (Node.js)</h2>
<p>To create a WebSocket server in Node.js we need to install a third-party package called <code class="language-text">socket.io</code> which is pretty popular. So follow these steps to create the server:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">mkdir -p websocket/node &amp;&amp; cd &quot;$_&quot;
yarn init -y
yarn add express socket.io
touch index.js</code></pre></div>
<p>Now open <code class="language-text">index.js</code> and add the following code:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"socket.io"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span>

io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"connection"</span><span class="token punctuation">,</span> <span class="token parameter">socket</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"listening on *:8080"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>As you can see we have initialized a new instance of <code class="language-text">socket.io</code> using <code class="language-text">http</code>. Then we added an event listener for the <code class="language-text">connection</code> event. This keeps listening to any incoming WebSocket connection so whenever a new WebSocket connection is established from the client, the callback is invoked. Inside the callback again we keep listening to the incoming request from the newly created connection, If the client emits an event called <code class="language-text">message</code> we broadcast the data to other subscribers. That's it, the backend part is done. Now let's create a frontend for it.</p>
<h2>WebSocket Client</h2>
<p>I don't want to explain the process of creating a React app as it's pretty easy to scaffold a React application using <code class="language-text">create-react-app</code>. So let's assume that we have an existing application and want to add chat functionality to it. First, make sure you have installed <code class="language-text">socket.io-client</code> package. I should also mention that I'm going to use Bootstrap for stylying the components. What we are going to build is this widget:</p>
<img class="img-res" src="/img/chat.png" alt="Chat" />
<p>To create such component I'll break it down into two separate components, one for each single message and the other for the chat widget. So let's go ahead and create them:</p>
<h3>Message component</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">import</span> user <span class="token keyword">from</span> <span class="token string">"../Assets/user.png"</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> userName<span class="token punctuation">,</span> message <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"media"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>img
          className<span class="token operator">=</span><span class="token string">"rounded-circle align-self-start mr-3"</span>
          src<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span>
          alt<span class="token operator">=</span><span class="token string">"Avatar"</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"media-body"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token string">"mt-0"</span><span class="token operator">></span><span class="token punctuation">{</span>userName<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
          <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"dropdown-divider"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Chat component</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">import</span> <span class="token string">"./Chat.css"</span>
<span class="token keyword">import</span> Message <span class="token keyword">from</span> <span class="token string">"./Message"</span>
<span class="token keyword">import</span> socketIOClient <span class="token keyword">from</span> <span class="token string">"socket.io-client"</span>
<span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token function">socketIOClient</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8080"</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>userName<span class="token punctuation">,</span> setUserName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> uName <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"Name?"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>uName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setUserName</span><span class="token punctuation">(</span>uName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>messages<span class="token punctuation">,</span> message<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"wrapper"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"card border-primary"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h5 className<span class="token operator">=</span><span class="token string">"card-header bg-primary text-white"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>i className<span class="token operator">=</span><span class="token string">"fas fa-comment"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">></span> Chat
        <span class="token operator">&lt;</span><span class="token operator">/</span>h5<span class="token operator">></span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"card-body overflow-auto"</span><span class="token operator">></span>
          <span class="token punctuation">{</span>messages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>Message
              key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span>
              userName<span class="token operator">=</span><span class="token punctuation">{</span>msg<span class="token punctuation">.</span>userName<span class="token punctuation">}</span>
              message<span class="token operator">=</span><span class="token punctuation">{</span>msg<span class="token punctuation">.</span>message<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"card-footer border-primary p-0"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"input-group"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>input
              value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span>
              onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
              type<span class="token operator">=</span><span class="token string">"text"</span>
              className<span class="token operator">=</span><span class="token string">"form-control input-sm"</span>
              placeholder<span class="token operator">=</span><span class="token string">"Type your message here..."</span>
            <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>button
              className<span class="token operator">=</span><span class="token string">"btn btn-primary btn-sm"</span>
              onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">_</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token punctuation">{</span>
                  id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span>
                  message<span class="token punctuation">,</span>
                  userName<span class="token punctuation">:</span> userName<span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
                <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>messages<span class="token punctuation">,</span> msg<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>

                socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">></span>
              Send
            <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>As you can see we first imported <code class="language-text">socket.io</code>. Then there are three parts to make it work. The first part is to connect to our WebSocket server:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> socketIOClient <span class="token keyword">from</span> <span class="token string">"socket.io-client"</span>
<span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token function">socketIOClient</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8080"</span><span class="token punctuation">)</span></code></pre></div>
<p>The second part is to listen to incoming messages from the backend. As soon as there is a new message we save it into our local state:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>messages<span class="token punctuation">,</span> message<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>The third part is when we click on <code class="language-text">Send</code> button which is simply emitting a new message to the WebSocket server:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span></code></pre></div>
<p>That's it. We just built a simple chat application in just a few minutes. Now let's create the same functionality using .NET Core.</p>
<h2>WebSocket Server (.NET Core)</h2>
<p>To create a WebSocket server in .NET Core we should use SignalR as it's incredibly simple yet powerful library to create real-time web applications. So let's type in the following commands to create a project:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">mkdir -p websocket/dotnet &amp;&amp; cd &quot;$_&quot;
dotnet new web</code></pre></div>
<p>Next we need something called <code class="language-text">Hub</code> which is a class for listening and emitting data to subscribers. So let's create a Hub called <code class="language-text">ChatHub</code>:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatHub</span> <span class="token punctuation">:</span> <span class="token class-name">Hub</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">Message</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> Clients<span class="token punctuation">.</span>Others<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageModel</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Message <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Then we will need to configure the server to respond to WebSocket requests. So let's change <code class="language-text">Startup.cs</code> as the following:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddCors</span><span class="token punctuation">(</span>o <span class="token operator">=></span> o<span class="token punctuation">.</span><span class="token function">AddPolicy</span><span class="token punctuation">(</span><span class="token string">"CorsPolicy"</span><span class="token punctuation">,</span> builder <span class="token operator">=></span>
        <span class="token punctuation">{</span>
            builder
            <span class="token punctuation">.</span><span class="token function">AllowAnyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AllowAnyHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">WithOrigins</span><span class="token punctuation">(</span><span class="token string">"http://localhost:3000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        services<span class="token punctuation">.</span><span class="token function">AddSignalR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseCors</span><span class="token punctuation">(</span><span class="token string">"CorsPolicy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        app<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=></span>
        <span class="token punctuation">{</span>
            endpoints<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">MapHub</span><span class="token punctuation">&lt;</span><span class="token class-name">ChatHub</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token string">"/chatHub"</span><span class="token punctuation">,</span> options <span class="token operator">=></span>
            <span class="token punctuation">{</span>
                options<span class="token punctuation">.</span>Transports <span class="token operator">=</span> HttpTransportType<span class="token punctuation">.</span>WebSockets<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>It worth mentioning that SignalR includes some built-in transports to keep the underlying connection open. It means that it automatically chooses the most efficient transport type during an initial stage called negotiation. In the code, we have purposely set <code class="language-text">WebSockets</code> transport by passing in a second argument to <code class="language-text">MapHub</code> method. This is because the main focus of this blog post. But you can set other supported transports if you want to, If you don't explicitly set the transports, SignalR will use the most efficient type for you as mentioned. That's it. The server is now ready to communicate with the client. Unfortunately, the client part needs a couple of changes as the <code class="language-text">socket.io-client</code> package doesn't support SignalR for its server as they are different in implementation. It means that we need to change the client code and the way it communicates with the server. First, we need to install an official Microsoft package:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn add @microsoft/signalr</code></pre></div>
<p>Since the component structure is almost the same with one we had in <code class="language-text">socket.io-client</code> so I'll just add the differences. First we need to import the SignalR package:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  HubConnectionBuilder<span class="token punctuation">,</span>
  LogLevel<span class="token punctuation">,</span>
  HttpTransportType<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@microsoft/signalr"</span></code></pre></div>
<p>Then we need to have a way to initialize and open the connection. We could do that by defining a <code class="language-text">useEffect</code> hook:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>connection<span class="token punctuation">,</span> setConnection<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> socketConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HubConnectionBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">configureLogging</span><span class="token punctuation">(</span>LogLevel<span class="token punctuation">.</span>Debug<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withUrl</span><span class="token punctuation">(</span><span class="token string">"http://localhost:5000/chatHub"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      skipNegotiation<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      transport<span class="token punctuation">:</span> HttpTransportType<span class="token punctuation">.</span>WebSockets<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> socketConnection<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setConnection</span><span class="token punctuation">(</span>socketConnection<span class="token punctuation">)</span>

  <span class="token comment">// as before</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p>We only want to initialize <code class="language-text">connection</code> when the component mounts that's why we provided an empty array as a second argument for the effect hook. Next we need to listen to any incoming message:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">connection <span class="token operator">&amp;&amp;</span>
  connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>messages<span class="token punctuation">,</span> message<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>As the final step we need a way to emit the messages when a user clicks on <code class="language-text">Send</code> button:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>button
  className<span class="token operator">=</span><span class="token string">"btn btn-primary btn-sm"</span>
  onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">_</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// as before</span>

    connection <span class="token operator">&amp;&amp;</span> connection<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">></span>
  Send
<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span></code></pre></div>
<p>That's all we need to do to configure SignalR into our React application. Now you can run the project and see the result:</p>
<img class="img-res" src="/img/chat-demo.gif" alt="Chat" />
<br/>
<p><strong>Note</strong>: If you want to host the SignalR server on IIS you will have to enable WebSocket on IIS because it's not enabled by default. You can follow <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/websockets?view=aspnetcore-3.1#iisiis-express-support">this process</a> to enable it:</p>
<img class="img-res" src="/img/IIS_WebSocket.png" alt="Enabling WebSockets on IIS" />
<br/>
<p>Source code (<a href="https://github.com/SirwanAfifi/realtime">https://github.com/SirwanAfifi/realtime</a>)</p></div></div><div class="widget-container"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/SZDwFA72s"><img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee"/><span style="margin-left:15px;font-size:28px !important">Buy me a coffee</span></a></div><div id="disqus_thread"></div></div><footer id="footer" class="inner"><div class="container"><div><div class="col-md-12"><p>Copyright © <!-- -->2020<!-- --> -<!-- --> <!-- -->Sirwan Afifi<!-- --> | Powered by Gatsby | Site design based on the <a href="http://hyde.getpoole.com/">Hyde theme</a></p></div></div></div></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/archive/2020/03/08/WebSocket-and-React/";window.webpackCompilationHash="58b7d869eaeeaf0984f3";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-319ed9ee6b302328ad48.js"],"component---src-templates-blog-list-template-js":["/component---src-templates-blog-list-template-js-6602e245c9ca59bdb990.js"],"component---src-templates-post-js":["/component---src-templates-post-js-0914d98d5e3a1ad21021.js"],"component---src-pages-about-js":["/component---src-pages-about-js-b14fef92f04bb4560744.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-5911f7d8a009a6de7eb7.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-048e682a434a219daca0.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d8fb73652771369dd209.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-0914d98d5e3a1ad21021.js" async=""></script><script src="/1-3383a112591cc5742233.js" async=""></script><script src="/styles-4a421e9d993baa00708b.js" async=""></script><script src="/app-319ed9ee6b302328ad48.js" async=""></script><script src="/webpack-runtime-15d8dc7caf8d5b05a8bb.js" async=""></script></body></html>